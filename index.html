<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Let's draw Music!</title>
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" /> -->
    <script src="https://cdn.jsdelivr.net/npm/vexflow/build/cjs/vexflow.js"></script>
  </head>

  <body>
    <button id="reload">새로고침</button>
    <button id="draw">음표 추가</button>
    <button id="drawPage">악보추가</button>
    <div id="output"></div>

    <script type="module">
      const { Renderer, Stave, StaveNote, Formatter } = Vex.Flow;

      // Create an SVG renderer and attach it to the DIV element with id="output".
      const div = document.getElementById("output");
      let renderer = new Renderer(div, Renderer.Backends.SVG);

      // Configure the rendering context.
      renderer.resize(750, 150);
      let context = renderer.getContext();
      context.setFont("Arial", 10);

      // Create a stave of width 400 at position 10, 40.
      let stave = new Stave(10, 40, 700);

      // Add a clef and time signature.
      stave.addClef("treble").addTimeSignature("4/4");

      // Connect it to the rendering context and draw!
      stave.setContext(context).draw();

      let notes = [];

      const draw = () => {
        const syllable = "cdefgab";
        const choice = Math.floor(Math.random() * 7);

        notes.push(new StaveNote({ keys: [`${syllable[choice]}/4`], duration: "q" }));

        // Helper function to justify and draw a 4/4 voice.
        Formatter.FormatAndDraw(context, stave, notes);
      };

      const drawPage = () => {
        notes = [];
        renderer = new Renderer(div, Renderer.Backends.SVG);

        renderer.resize(750, 150);
        context = renderer.getContext();
        context.setFont("Arial", 10);

        stave = new Stave(10, 40, 700);
        stave.addClef("treble").addTimeSignature("4/4");

        stave.setContext(context).draw();
      };

      document.getElementById("reload").addEventListener("click", function () {
        location.reload();
      });
      document.getElementById("draw").addEventListener("click", draw);
      document.getElementById("drawPage").addEventListener("click", drawPage);
    </script>
  </body>
</html>
