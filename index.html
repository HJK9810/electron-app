<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Let's draw Music!</title>
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" /> -->
    <script src="https://cdn.jsdelivr.net/npm/vexflow/build/cjs/vexflow.js"></script>
  </head>

  <body>
    <button id="reload">새로고침</button>
    <button id="draw">음표 추가</button>
    <button id="drawPage">악보추가</button>
    <br />
    <p style="text-align: center">악보추가 버튼을 눌러주세요!!!</p>
    <div id="output"></div>

    <script type="module">
      const { Renderer, Stave, StaveNote, Formatter } = Vex.Flow;

      // Create an SVG renderer and attach it to the DIV element with id="output".
      const div = document.getElementById("output");
      let renderer; // rendering box size and set
      let context; // size setting
      let stave; // for clef and meter && for draw
      let notes = []; // for notes ary

      const draw = () => {
        const syllable = "cdefgab";
        const choice = Math.floor(Math.random() * 7);

        if (notes.length == 4) {
          alert(
            "더이상의 4분음표 입력은 불가능합니다. 다른 악보를 그려주세요."
          );
        } else {
          notes.push(
            new StaveNote({ keys: [`${syllable[choice]}/4`], duration: "q" })
          );

          // Helper function to justify and draw a 4/4 voice.
          Formatter.FormatAndDraw(context, stave, notes);
        }
      };

      const drawPage = () => {
        notes = [];
        renderer = new Renderer(div, Renderer.Backends.SVG);

        renderer.resize(750, 150);
        context = renderer.getContext();
        context.setFont("Arial", 10);

        stave = new Stave(10, 40, 700);
        stave.addClef("treble").addTimeSignature("4/4");

        stave.setContext(context).draw();
      };

      document.getElementById("reload").addEventListener("click", function () {
        location.reload();
      });
      document.getElementById("draw").addEventListener("click", draw);
      document.getElementById("drawPage").addEventListener("click", drawPage);
    </script>
  </body>
</html>
