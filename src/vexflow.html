<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Let's draw Music!</title>
    <!-- <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" /> -->
    <script src="https://cdn.jsdelivr.net/npm/vexflow/build/cjs/vexflow.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT"
      crossorigin="anonymous"
    />
  </head>

  <body class="m-2">
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
      crossorigin="anonymous"
    ></script>

    <button id="reload" class="btn btn-outline-secondary">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-arrow-clockwise"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"
        />
        <path
          d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"
        />
      </svg>
    </button>
    <button id="draw" class="btn btn-outline-success">음표 추가</button>
    <button id="drawPage" class="btn btn-outline-info">악보추가</button>
    <br />
    <p style="text-align: center">악보추가 버튼을 눌러주세요!!!</p>
    <div id="output"></div>

    <script type="module">
      const { Renderer, Stave, StaveNote, Formatter } = Vex.Flow;

      // Create an SVG renderer and attach it to the DIV element with id="output".
      const div = document.getElementById("output");
      let renderer; // rendering box size and set
      let context; // size setting
      let stave; // for clef and meter && for draw
      let notes = []; // for notes ary

      const draw = () => {
        const syllable = "cdefgab";
        const choice = Math.floor(Math.random() * 7);

        if (notes.length == 4) {
          alert(
            "더이상의 4분음표 입력은 불가능합니다. 다른 악보를 그려주세요."
          );
        } else {
          notes.push(
            new StaveNote({ keys: [`${syllable[choice]}/4`], duration: "q" })
          );

          // Helper function to justify and draw a 4/4 voice.
          Formatter.FormatAndDraw(context, stave, notes);
        }
      };

      const drawPage = () => {
        notes = [];
        renderer = new Renderer(div, Renderer.Backends.SVG);

        renderer.resize(750, 150);
        context = renderer.getContext();
        context.setFont("Arial", 10);

        stave = new Stave(10, 40, 700);
        stave.addClef("treble").addTimeSignature("4/4");

        stave.setContext(context).draw();
      };

      document.getElementById("reload").addEventListener("click", function () {
        location.reload();
      });
      document.getElementById("draw").addEventListener("click", draw);
      document.getElementById("drawPage").addEventListener("click", drawPage);
    </script>
  </body>
</html>
